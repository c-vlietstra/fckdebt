# Security for F*ckDebt

## Overview
F*ckDebt locks down your financial data with a user-owned AES-256 key we never see. Mobile-first with a secure web login option, it’s built so even a full breach leaves your data useless to attackers. Privacy is yours—we’re just the pipes.

## Principles
- **User-Owned Keys**: You generate and hold the master key; we don’t.
- **Zero Knowledge**: Server never sees plaintext or permanent keys.
- **Temporary Access**: Web logins use short-lived keys via mobile approval.
- **Fail-Safe**: Lose control, lose access—data stays encrypted.

## Data Protection

### Hashed Data
- **Email**: `email_hash` (bcrypt, 12 rounds).
- **Password**: `password_hash` (bcrypt, 12 rounds).

### Encrypted Data
- **Fields**: All sensitive data (e.g., `debt_name_encrypted`, `monthly_income_encrypted`).
- **Permanent Key**: AES-256-GCM, 32 bytes:
  - Generated by Flutter app on signup (`encrypt.Key.fromSecureRandom`).
  - Stored in `flutter_secure_storage`, encrypted with device keystore.
  - User saves it as a recovery key (shown once).
- **Temporary Key (Web)**: AES-256, 32 bytes:
  - Generated by backend on mobile approval.
  - Encrypted with permanent key, stored in `web_sessions.temp_key_encrypted`.
  - Expires in 24 hours.
- **Storage**: Encrypted fields as BYTEA.

### Plaintext Data
- IDs, foreign keys, `budget_method`, percentages, dates, booleans.

## Key Management

### Mobile
- **Generation**: App creates AES-256 key on signup.
- **Storage**: Encrypted in `flutter_secure_storage`.
- **Recovery**: User copies key (one-time prompt).
- **Fail-Safe**: 5 failed logins → key wiped; recovery key needed.

### Web
- **Login Flow**:
  1. Browser sends email/password.
  2. Backend pushes notification to mobile via FCM.
  3. Mobile app approves, sends permanent AES key (HTTPS).
  4. Backend creates temp key, encrypts it with permanent key, sends to browser.
- **Storage**: Temp key in memory/secure cookie, expires in 24h.
- **No Permanent Key**: Browser never gets the master key.

## Security Measures

### Database
- **No PII**: Only hashed email/password.
- **Encryption**: Data locked with user’s permanent key.
- **Web Sessions**: `web_sessions` tracks temp keys with expiry.

### Backend
- **Key Handling**: Never stores permanent key; processes it in memory.
- **JWT**: Short-lived (1h), HS256-signed.
- **Rate Limiting**: 5 attempts/minute; tracks `failed_attempts`.

### Frontend
- **Mobile**: `flutter_secure_storage` + fail-safe logic.
- **Web**: Temp key via HTTPS; no local persistence.

### Transmission
- **HTTPS**: TLS 1.3.
- **CORS**: Restricted to F*ckDebt app/web.
- **HSTS**: Enabled.

## Breach Scenario
- **Database**: Hashed creds, encrypted data—useless without permanent key.
- **Server**: No permanent keys stored; temp keys expire.
- **Outcome**: Data safe unless user’s device/recovery key is compromised.

## Trade-offs
- **Recovery**: Lose your key, lose your data—no server backup.
- **Web Login**: Requires mobile approval; no standalone access.
- **Upside**: Absolute privacy; we can’t decrypt anything.

## Implementation
- **Flutter**: `encrypt` for key gen, `flutter_secure_storage` for storage.
- **Node.js**: `crypto` for temp key gen/encryption.
- **FCM**: Push notifications for web login approval.

---
Issues? Open a ticket or email <me@coenraad.co.za>.